{"version":3,"file":"static/js/875.f12ef9c8.chunk.js","mappings":"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","sources":["hooks/useCanvasColorChange.tsx","hooks/useCanvasListener.tsx","hooks/useCanvasPenSizeChange.tsx","components/SketchPad.tsx","utils/tensorUtils.tsx","components/DigitRecognizer.tsx","containers/DigitRecognitionApp.tsx"],"sourcesContent":["import { useEffect } from \"react\";\n\nconst useCanvasColorChange = (canvasRef: React.RefObject<HTMLCanvasElement>, color: string) => {\n    useEffect(() => {\n        const changeColor = () => {\n            if (canvasRef.current) {\n                const canvas: HTMLCanvasElement = canvasRef.current;\n                const context = canvas.getContext(\"2d\");\n                if (context) {\n                        context.lineCap = \"round\";\n                        context.strokeStyle = color;\n                }\n            }\n        }\n        changeColor();\n    }, [canvasRef, color])\n}\n\nexport default useCanvasColorChange;","import { useEffect } from \"react\";\n\nconst useCanvasListener = (canvasRef: React.RefObject<HTMLCanvasElement>, isIdle: React.MutableRefObject<boolean>) => {\n    \n    function getStrokeVector (event: MouseEvent, canvas: HTMLCanvasElement) {\n        return [event.pageX - canvas.offsetLeft,\n        event.pageY - canvas.offsetTop] as [number, number]\n    }\n\n    useEffect(() => {\n        const canvas: HTMLCanvasElement|null = canvasRef.current;\n        const context = canvas?.getContext(\"2d\");\n        function drawStart(event: MouseEvent) {\n            if (canvas && context) {\n                context.beginPath();\n                context.moveTo(\n                    ...getStrokeVector(event, canvas)\n                );\n                drawMove(event);\n                isIdle.current = false;\n            }\n        }\n        const drawEnd = () => {\n            isIdle.current = true;\n        }\n        \n\n        const drawMove = (event: MouseEvent) => {\n            if (isIdle.current) return;\n            if (canvas && context) {\n                context.lineTo(\n                    ...getStrokeVector(event, canvas)\n                );\n                context.stroke();\n            }\n        }\n     \n        const addListeners = () => {\n            if (canvas) {\n                canvas.addEventListener(\"mousedown\", drawStart, false);\n                canvas.addEventListener(\"mousemove\", drawMove, false);\n                canvas.addEventListener(\"mouseup\", drawEnd, false);\n                \n                return () => {\n                    canvas.removeEventListener('mousedown', drawStart)\n                    canvas.removeEventListener('mousemove', drawMove)\n                    canvas.removeEventListener('mouseup', drawEnd)\n                }\n            }\n        }\n        addListeners();\n    }, [canvasRef, isIdle]);\n}\n\nexport default useCanvasListener;","import { useEffect } from \"react\";\n\nconst useCanvasPenSizeChange = (canvasRef: React.RefObject<HTMLCanvasElement>, penSize: number) => {\n    \n    useEffect(() => {\n        const changePenSize = () => {\n            if (canvasRef.current) {\n                const canvas: HTMLCanvasElement = canvasRef.current;\n                const context = canvas.getContext(\"2d\");\n                if (context) {\n                    context.lineWidth = penSize;\n                }\n            }\n        }\n        changePenSize();\n    }, [canvasRef, penSize])\n}\n\nexport default useCanvasPenSizeChange;","import { useEffect, useRef } from \"react\";\n\nimport \"../styles/Base.scss\";\n\nimport useCanvasColorChange from \"../hooks/useCanvasColorChange\";\nimport useCanvasListener from \"../hooks/useCanvasListener\";\nimport useCanvasPenSizeChange from \"../hooks/useCanvasPenSizeChange\";\n\nexport default function SketchPad(props: { width: number, height: number, canvasColor: string, penColor: string, penSize: number, canvasRef: React.RefObject<HTMLCanvasElement> }) {\n    const isIdle = useRef(true);\n\n    useEffect(() => {\n        const renderCanvas = () => {\n            if (props.canvasRef.current) {\n                const canvas: HTMLCanvasElement = props.canvasRef.current;\n                const context = canvas.getContext(\"2d\");\n                if (context) {\n                    context.lineCap = \"round\";\n                    context.lineJoin = 'round'\n                    context.strokeStyle = props.penColor;\n                    context.fillStyle = props.canvasColor;\n                    context.fillRect(0, 0, props.width, props.height);\n                    context.lineWidth = props.penSize;\n                    context.globalCompositeOperation = \"source-over\";\n                }\n            }\n        }\n        renderCanvas();\n    }, [props.width, props.height]) // eslint-disable-line react-hooks/exhaustive-deps\n\n    useCanvasColorChange(props.canvasRef, props.penColor);\n    useCanvasPenSizeChange(props.canvasRef, props.penSize);\n    useCanvasListener(props.canvasRef, isIdle)\n\n    function clearCanvas() {\n        const canvas: HTMLCanvasElement | null = props.canvasRef.current;\n        if (canvas) {\n            const context = canvas.getContext(\"2d\");\n            if (context) {\n                context.fillStyle = props.canvasColor;\n                context.fillRect(0, 0, props.width, props.height);\n            }\n        }\n    }\n\n\n    return (\n        <div>\n            <div>\n                <button style={{ width: props.width }} onClick={clearCanvas}>Clear</button>\n            </div>\n            <div>\n                <canvas onMouseEnter={(e) => {\n                    if (e.buttons === 1 && props.canvasRef.current) {\n                        props.canvasRef.current?.getContext(\"2d\")?.beginPath();\n                        isIdle.current = false;\n                    }\n                }} onMouseLeave={() => isIdle.current = true} ref={props.canvasRef} width={props.width} height={props.height} style={{ border: \"1px solid #000000\" }} />\n            </div>\n        </div>\n    )\n}\n\nSketchPad.defaultProps = {\n    width: 400,\n    height: 400,\n    canvasColor: \"#FFFFFF\",\n    penColor: \"#000000\",\n    penSize: 12\n}","import * as tf from \"@tensorflow/tfjs\";\nimport { LayersModel, Tensor3D } from \"@tensorflow/tfjs\";\n\nexport function getResizedTensor(tensor: Tensor3D) {\n    return tf.tidy(() => {\n      const resizedTensor = tf.image.resizeNearestNeighbor(\n        tensor,\n        [28, 28],\n        true\n      );\n      return resizedTensor;\n    });\n  }\n\n export async function getResultsFromCanvasTensor(model: LayersModel, tensor: Tensor3D) {\n    const normalizedTensor  = tensor.dataSync().map((x) => {return x / 255});\n    const threeDTensor = tf.tensor3d(normalizedTensor, [28, 28, 1]);\n    const expandedTensor =  threeDTensor.expandDims();\n    const results = model.predict(expandedTensor);\n    // @ts-expect-error\n    const predictions = await results.array();\n    tf.dispose([tensor, normalizedTensor, threeDTensor, expandedTensor, results, predictions]);\n    return predictions[0];\n  }","import { useCallback, useEffect, useRef, useState } from \"react\";\nimport * as tf from \"@tensorflow/tfjs\";\nimport { LayersModel, Tensor3D } from \"@tensorflow/tfjs\";\n\nimport \"../styles/Base.scss\";\nimport * as tensorUtils from '../utils/tensorUtils';\n\nexport default function NumberRecognizer(props: { canvas: any }) {\n\n  const [prediction, setPrediction] = useState(0);\n  const [model, setModel] = useState<LayersModel | null>(null);\n  const smallCanvasRef = useRef<HTMLCanvasElement>(null);\n\n  useEffect(() => {\n    (async () => {\n      if (!model) {\n        let loadedModel: LayersModel;\n        try {\n          loadedModel = await tf.loadLayersModel('https://raw.githubusercontent.com/ixartz/handwritten-digit-recognition-tensorflowjs/master/public/classifiers/model.json'); //I decided to borrow this model since my own is struggling with recognizing 9s.\n        } catch (error) {\n          console.log('Model loading error: ' + error + '\\nFalling back to the saved one');\n          loadedModel = await tf.loadLayersModel('http://' + window.location.host + '/models/digit-recognition-model/digit-recognition-model.json'); //here's my model just in case\n        }\n        setModel(loadedModel!);\n      }\n    })();\n  }, [model]);\n\n  const makePrediction = useCallback(\n    async function MakePrediction(canvas: any, model: LayersModel) {\n      tf.engine().startScope();\n      const canvasTensor = tf.browser.fromPixels(canvas.current, 1);\n      const resizedCanvasTensor = tensorUtils.getResizedTensor(canvasTensor);\n      displayComparisonTensor(resizedCanvasTensor);\n      const results = tensorUtils.getResultsFromCanvasTensor(model, resizedCanvasTensor);\n      results.then(res => { displayResults(res); tf.dispose([res]) });\n      tf.dispose([canvasTensor, resizedCanvasTensor]);\n      tf.engine().endScope();\n\n      function displayComparisonTensor(tensor: Tensor3D) {\n        tf.browser.toPixels(tensor, smallCanvasRef.current as HTMLCanvasElement);\n      }\n\n      function displayResults(predictions: Number[]) {\n        setPrediction(predictions.reduce(pickIndexOfMaxValue, 0))\n\n        function pickIndexOfMaxValue(indexOfMaxValue: number, currentValue: Number, currentIndex: number, arr: Number[]) {\n          return currentValue > arr[indexOfMaxValue] ? currentIndex : indexOfMaxValue;\n        }\n      }\n    }\n    , []);\n\n  return (\n    <div>\n      <button onClick={() => { tf.tidy(() => { makePrediction(props.canvas, model!) }) }}>Predict</button>\n      <h1>{prediction}</h1>\n      <canvas width={28} height={28} ref={smallCanvasRef}></canvas>\n    </div>\n  )\n}\n","import \"../styles/Base.scss\";\nimport SketchPad from \"../components/SketchPad\";\nimport NumberRecognizer from \"../components/DigitRecognizer\";\nimport { useRef } from \"react\";\n\nexport default function NumberRecognitionApp() {\n    const canvasRef = useRef<HTMLCanvasElement>(null);\n    return (\n        <div>\n            <p>Digit Recognition</p>\n            <SketchPad canvasColor={'#000000'} penColor={\"white\"} width={280} height={280} penSize={20} canvasRef={canvasRef} />\n            <NumberRecognizer canvas={canvasRef}></NumberRecognizer>\n        </div>\n    )\n}"],"names":["canvasRef","color","useEffect","current","context","getContext","lineCap","strokeStyle","changeColor","isIdle","getStrokeVector","event","canvas","pageX","offsetLeft","pageY","offsetTop","drawStart","beginPath","moveTo","apply","_toConsumableArray","drawMove","drawEnd","lineTo","stroke","addEventListener","addListeners","penSize","lineWidth","changePenSize","SketchPad","props","useRef","lineJoin","penColor","fillStyle","canvasColor","fillRect","width","height","globalCompositeOperation","renderCanvas","useCanvasColorChange","useCanvasPenSizeChange","useCanvasListener","_jsxs","children","_jsx","style","onClick","onMouseEnter","e","_props$canvasRef$curr","_props$canvasRef$curr2","buttons","onMouseLeave","ref","border","defaultProps","getResizedTensor","tensor","tf","getResultsFromCanvasTensor","_x","_x2","_getResultsFromCanvasTensor","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","model","normalizedTensor","threeDTensor","expandedTensor","results","predictions","wrap","_context","prev","next","dataSync","map","x","expandDims","predict","array","sent","abrupt","stop","NumberRecognizer","_useState","useState","_useState2","_slicedToArray","prediction","setPrediction","_useState3","_useState4","setModel","smallCanvasRef","loadedModel","t0","console","log","window","location","host","makePrediction","useCallback","_MakePrediction","_callee2","canvasTensor","resizedCanvasTensor","displayComparisonTensor","displayResults","_context2","reduce","indexOfMaxValue","currentValue","currentIndex","arr","startScope","tensorUtils","then","res","endScope","NumberRecognitionApp"],"sourceRoot":""}